# Gemini Code Assistant Context

This document provides context for the Gemini AI code assistant to understand and effectively assist with this project.

## Project Overview

This project uses Terraform to provision and manage a personal homelab environment on Oracle Cloud Infrastructure (OCI). It combines Terraform for infrastructure as code and Ansible for configuration management.

The primary goal is to create a secure and flexible environment for hosting various services, including:

*   **A WireGuard VPN server:** To provide secure access to the internal network.
*   **An n8n instance:** For workflow automation.
*   **Traefik:** As a reverse proxy to manage and secure traffic to the services.

### Architecture

The infrastructure is designed with a public and a private subnet:

*   **Public Subnet:** Contains a bastion host that also functions as a WireGuard VPN server (`wg-easy`). This instance has a public IP address and is the entry point to the VCN. Traefik is also deployed on this host to act as a reverse proxy.
*   **Private Subnet:** Hosts the n8n service, which is not directly accessible from the public internet. It can only be accessed through the VPN or via the reverse proxy.

### Technologies

*   **Terraform:** Used to define and provision all OCI resources, including the VCN, subnets, security lists, route tables, and virtual machines.
*   **Ansible:** Used to configure the virtual machines after they are created. This includes installing Docker, setting up Traefik, and deploying the `wg-easy` and `n8n` Docker containers.
*   **Docker:** The services (`wg-easy`, `n8n`, and `Traefik`) are containerized and managed using Docker Compose.
*   **OCI (Oracle Cloud Infrastructure):** The cloud provider where the infrastructure is deployed.

## Building and Running

This project is managed through a combination of Terraform and Ansible.

### 1. Terraform (Infrastructure Provisioning)

To apply the Terraform configuration, you will need to have your OCI credentials configured.

**Initialize Terraform:**
```bash
terraform init
```

**Plan the changes:**
```bash
terraform plan
```

**Apply the changes:**
```bash
terraform apply
```

### 2. Ansible (Configuration Management)

The Ansible playbook is automatically executed by Terraform after the infrastructure is provisioned, using a `local-exec` provisioner.

The main playbook is `ansible/site.yml`. It performs the following tasks:

*   Installs Docker and Docker Compose on both servers.
*   Configures Traefik on the VPN server.
*   Deploys `wg-easy` on the VPN server.
*   Deploys `n8n` on the n8n server.

To run the playbook manually (for example, after making changes to the Ansible roles), you can use the following command:

```bash
ansible-playbook -i ansible/inventory.ini ansible/site.yml
```
**Note:** The `ansible/inventory.ini` file is dynamically generated by Terraform.

## Development Conventions

*   **Terraform:**
    *   Resources are organized into logical files (e.g., `network.tf`, `vpn.tf`, `n8n.tf`).
    *   Variables are defined in `variables.tf` and their values are provided in `terraform.tfvars`.
    *   Local values and default tags are defined in `locals.tf`.
*   **Ansible:**
    *   The main playbook is `ansible/site.yml`.
    *   The inventory is dynamically generated by Terraform into `ansible/inventory.ini`.
    *   Docker Compose files and other configuration files are managed as templates (`.j2` files) in the `ansible/templates` directory.
*   **Secrets:**
    *   SSH keys and other sensitive information are passed as variables to Terraform and should be managed securely. The `terraform.tfvars` file contains paths to these secrets and should not be committed to version control.
