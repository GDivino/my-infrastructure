# Gemini Code Assistant Context

This document provides context for the Gemini AI code assistant to understand and effectively assist with this project.

## Project Overview

This repository is a monorepo containing multiple Terraform projects to provision and manage personal cloud infrastructure across Amazon Web Services (AWS) and Oracle Cloud Infrastructure (OCI).

The repository is structured into three main projects:

*   **`s3-backend`:** A foundational project that provisions an S3 bucket in AWS to be used as a remote backend for Terraform state.
*   **`identity-center`:** An AWS project that manages users, groups, and permissions using AWS IAM Identity Center (formerly AWS SSO).
*   **`homelab`:** An OCI project that provisions a personal homelab environment, including networking, virtual machines, and services like a VPN, n8n, and Traefik. It uses Ansible for configuration management.

### Technologies

*   **Terraform:** Used as the primary Infrastructure as Code (IaC) tool across all projects.
*   **Ansible:** Used for configuration management in the `homelab` project to install and configure services on the provisioned VMs.
*   **Docker:** Used in the `homelab` project to containerize and run services like `wg-easy`, `n8n`, and `Traefik`.
*   **AWS:** The cloud provider for the `s3-backend` and `identity-center` projects.
*   **OCI (Oracle Cloud Infrastructure):** The cloud provider for the `homelab` project.

## Building and Running

Each subdirectory (`s3-backend`, `identity-center`, `homelab`) is an independent Terraform project and should be managed from within its respective directory.

### 1. `s3-backend` (AWS)

This project should be applied first to create the S3 bucket for Terraform's remote state.

```bash
cd s3-backend
terraform init
terraform plan
terraform apply
```

### 2. `identity-center` (AWS)

This project manages IAM Identity Center resources. It can be configured to use the S3 backend created in the previous step.

```bash
cd identity-center
terraform init
terraform plan
terraform apply
```

### 3. `homelab` (OCI)

This project provisions the homelab on OCI. It also uses a `local-exec` provisioner to run an Ansible playbook for configuration.

```bash
cd homelab
terraform init
terraform plan
terraform apply
```

#### Running Ansible Manually

The Ansible playbook can also be run manually after the infrastructure has been provisioned. The inventory file is dynamically generated by Terraform.

```bash
cd homelab
ansible-playbook -i ansible/inventory.ini ansible/site.yml
```

## Development Conventions

*   **Modular Structure:** The repository is organized into independent, single-purpose Terraform projects, promoting separation of concerns.
*   **Terraform:**
    *   Each project has its own set of Terraform files (`.tf`).
    *   Variables are defined in `variables.tf` and values should be provided in a `terraform.tfvars` file (which should not be committed to version control).
*   **Ansible (`homelab` project):**
    *   The main playbook is `ansible/site.yml`.
    *   The inventory is dynamically generated by Terraform into `ansible/inventory.ini`.
    *   Configuration files are managed as templates (`.j2` files) in the `ansible/templates` directory.
*   **Secrets:**
    *   Sensitive information such as API keys, SSH keys, and credentials should be managed via `terraform.tfvars` files and must not be committed to version control.
